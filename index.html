// --- â–¼â–¼â–¼ ã“ã“ã‹ã‚‰è¿½åŠ ã‚³ãƒ¼ãƒ‰ (Ambienté€£æº: ç©ºèª¿) â–¼â–¼â–¼ ---

        // 1. ç©ºèª¿ã®å ´æ‰€ï¼ˆåº§æ¨™ 5.74, 1.52, 0.60ï¼‰ã«ã‚¿ã‚°ã‚’ä½œã‚‹
        let a = new Potree.Annotation({
            position: [5.74, 1.52, 0.60],
            title: "ç©ºèª¿ (èª­è¾¼ä¸­...)",
            description: "ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ã¾ã™..."
        });
        viewer.scene.annotations.add(a);

        // 2. Ambientã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–ã£ã¦ãã‚‹é–¢æ•°
        async function updateACData() {
            // ã‚ãªãŸã®ãƒãƒ£ãƒãƒ«ID (95062)
            const url = "https://ambidata.io/api/v2/channels/95062/data?n=1";

            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.length > 0) {
                    const latest = data[0]; // ä¸€ç•ªæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿
                    const statusNum = latest.d1; // 1=ON, 0=OFF (Pythonã‚³ãƒ¼ãƒ‰ã‚ˆã‚Š)
                    const setTemp   = latest.d2; // è¨­å®šæ¸©åº¦ (OCR)
                    const roomTemp  = latest.d3; // å®¤æ¸© (BME680)
                    const time      = new Date(latest.created).toLocaleTimeString();

                    // æ•°å­—ã‚’ã€Œè¨€è‘‰ã€ã¨ã€Œè‰²ã€ã«å¤‰æ›
                    let statusText = "âš« åœæ­¢ (OFF)";
                    let statusColor = "#aaaaaa"; // ã‚°ãƒ¬ãƒ¼
                    
                    if (statusNum == 1) {
                        statusText = "ğŸŸ¢ ç¨¼åƒä¸­ (ON)";
                        statusColor = "#00ff00"; // ç·‘è‰²
                    }

                    // ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
                    a.title = `ç©ºèª¿: ${statusNum == 1 ? "ON" : "OFF"}`;

                    // è©³ç´°ï¼ˆå¹ãå‡ºã—ã®ä¸­èº«ï¼‰ã‚’ä½œã‚‹
                    a.description = `
                        <div style="width: 500px; padding: 5px;">
                            <h2 style="margin: 0; color: ${statusColor};">${statusText}</h2>
                            <p style="color: white; font-size: 1.1em; margin: 5px 0;">
                                è¨­å®šæ¸©åº¦: <b>${setTemp ? setTemp : "--"}â„ƒ</b> / 
                                å®¤æ¸©: <b>${roomTemp}â„ƒ</b>
                            </p>
                            <hr style="border-color: #555;">
                            <iframe 
                                src="https://ambidata.io/ch/95062" 
                                width="100%" height="300" 
                                style="border:none; background:white;">
                            </iframe>
                            <p style="text-align:right; font-size:0.8em; color:#ccc; margin:0;">æ›´æ–°æ™‚åˆ»: ${time}</p>
                        </div>
                    `;
                }
            } catch (e) {
                console.error("Ambientå–å¾—ã‚¨ãƒ©ãƒ¼:", e);
                a.title = "ç©ºèª¿ (ã‚¨ãƒ©ãƒ¼)";
                a.description = "ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>Ambientã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
            }
        }

        // 3. å®Ÿè¡Œã™ã‚‹ï¼ˆåˆå› & ã‚¯ãƒªãƒƒã‚¯æ™‚ï¼‰
        updateACData(); 
        a.domElement.addEventListener("click", () => {
            updateACData();     // æœ€æ–°æƒ…å ±ã‚’å–ã‚‹
            a.setExpanded(true); // å¹ãå‡ºã—ã‚’é–‹ã
        });

        // --- â–²â–²â–² è¿½åŠ ã‚³ãƒ¼ãƒ‰ã“ã“ã¾ã§ â–²â–²â–² ---
